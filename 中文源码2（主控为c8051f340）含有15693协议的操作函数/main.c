/*************************************************************************************************
* ?? ?? ????MAIN.C
* ??    ???RFID?????TRF7960????????????????????
*
* ?    ???? TRF7960??C8051F340?????????????????????SPI???????PAR????              
*                       
* ??    ???EMDOOR
* ??    ???2011-9-29
***************************************************************************************************/
#include <c8051f340.h>                            //???????????????
#include <host.h>
#include <hardware.h>
#include <automatic.h>
#include <communicate.h>
#include <globals.h>                         
char     rxdata;                                    //RS232 ???????????
xdata    unsigned char buf[BUF_LENGTH];             //????MSP430?????????TRF7960???????????
signed   char RXTXstate;                            //???³²????????????????
unsigned char flags;                                //????›¥???¦Ë(??????????)
unsigned char RXErrorFlag;                          //????????????
unsigned char RXflag;                               //???????????¦Ë?????????????????????????
unsigned char i_reg;                                //?§Ø?????????
unsigned char CollPoss;                             //??????????¦Ë?????

/**************************************************************************************************
* ?????????main()
* ??    ?????????????
* ??????????
* ???????????
* ?    ???????????????????§³?
****************************************************************************************************/
void main(void)
{
//==================================================================================================
    PCA0MD   &= ~0x40;
    PCA0MD    = 0x00;   //???????
//==================================================================================================  
    OSCsel();  //?????????
  	PORT_Init();//???????????
    UART0_Init();  //?????????
   
 //????????????????????????
/*=================================================================================================*/
    EnableSet(); //????????                                      
	TRFDisable(); //?????????  
	delay_ms(1);  
	TRFEnable();//????????   
	delay_ms(1);  
	IRQPinset();                //???IRQ?§Ø???
    IRQInit();
  
    SlaveSelectPortSet();       //c8051f340P0.3Slave Select????????
    H_SlaveSelect();            //Slave Select???(??)
    SIMOSet();					//????SIMO????
    SOMISIGNALSET();
	CLKPOUTset();				//???????????????

    TRFDisable();
	delay_ms(1);
    TRFEnable();
    delay_ms(1);
	
    InitialSettings();           //??????????????MSP430???????6.78MHz??OOK??????
    EnableInterrupts();          //??????§Ø?
    
    OOKdirIN();                  //????OOK???????????
    
    while(1)                                      
    { 
                                 //??????§¿????????
	 FindTags();
	  
    }
}




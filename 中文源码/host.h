/**********************************************************************************************************************************************************
* 文 件 名：HOST.H
* 功    能：SPI相关初始化函数USART和UART串口相关命令头文件。
*
* 作    者：EMDOOR
* 日    期：2011年04月13号
**********************************************************************************************************************************************************/
#ifndef HOST_H
#define HOST_H


#include <MSP430x23x0.h>     	
#include <stdio.h>
#include "hardware.h"
#include "globals.h"

//#define BAUD0	    0x75	//外部13.56 MHz时钟下115200波特率高位设置值
#define BAUD0	    0x3A	//外部6.78 MHz时钟下115200波特率高位设置值
#define BAUD1	    0x00        //外部13.56 MHz和6.78 MHz时钟下115200波特率低位设置值

#define BAUD0EN     0x45	//内部DCO 8 MHz时钟下115200波特率高位设置值
#define BAUD1EN     0x00        //内部DCO 8 MHz时钟下115200波特率低位设置值

/******************************************************************************************************************
* 函数名称：UARTset()
* 功    能：串口初始化设置函数
* 入口参数：无
* 出口参数：无
* 说    明：该串口初始化函数使用USCI_A0。    
*******************************************************************************************************************/
void UARTset(void);

/******************************************************************************************************************
* 函数名称：USARTset()
* 功    能：SPI初始化设置函数
* 入口参数：无
* 出口参数：无
* 说    明：该函数使用内部晶体振荡器配置 USCI_B0。    
*******************************************************************************************************************/
void USARTset(void);

/******************************************************************************************************************
* 函数名称：USARTEXTCLKset()
* 功    能：SPI初始化设置函数
* 入口参数：无
* 出口参数：无
* 说    明：该函数使用外部晶体振荡器配置 USCI_B0。    
*******************************************************************************************************************/
void USARTEXTCLKset(void);

/******************************************************************************************************************
* 函数名称：BaudSet()
* 功    能：串口通信设置函数
* 入口参数：mode    模式设置
* 出口参数：无
* 说    明：程序默认外部晶体频率为6.78MHz;内部DCO模式频率为8MHz    
*******************************************************************************************************************/
void BaudSet(unsigned char mode);

/******************************************************************************************************************
* 函数名称：kputchar()
* 功    能：向计算器上位机发送一个字符函数
* 入口参数：TXchar    将要被发送的字符
* 出口参数：无
* 说    明：无   
*******************************************************************************************************************/
void kputchar(char TXchar);

/******************************************************************************************************************
* 函数名称：put_bksp()
* 功    能：向计算器上位机发送一个退格Backspace符号
* 入口参数：无
* 出口参数：无
* 说    明：无   
*******************************************************************************************************************/
void put_bksp(void);

/******************************************************************************************************************
* 函数名称：put_space()
* 功    能：向计算器上位机发送一个空格符号
* 入口参数：无
* 出口参数：无
* 说    明：无   
*******************************************************************************************************************/
void put_space(void);

/******************************************************************************************************************
* 函数名称：put_crlf()
* 功    能：向计算器上位机发送一个回车+换行符号
* 入口参数：无
* 出口参数：无
* 说    明：无   
*******************************************************************************************************************/
void put_crlf(void);

/******************************************************************************************************************
* 函数名称：send_cstring()
* 功    能：向计算器上位机发送一字符串
* 入口参数：*pstr       将要被发送的字符串
* 出口参数：无
* 说    明：无   
*******************************************************************************************************************/
void send_cstring(char *pstr);

/******************************************************************************************************************
* 函数名称：Nibble2Ascii()
* 功    能：半位字节转化成ASCII十六进制码
* 入口参数：anibble         将要被转换字节
* 出口参数：AsciiOut        转换后的ASCII十六进制码值
* 说    明：无   
*******************************************************************************************************************/
unsigned char Nibble2Ascii (unsigned char anibble);

/******************************************************************************************************************
* 函数名称：Put_byte()
* 功    能：发送字节函数半位字节转化成ASCII十六进制码
* 入口参数：abyte         将要被发送字节
* 出口参数：无      
* 说    明：该函数调用两次Nibble2Ascii，将一个字节拆分成高低四位，先转换再次序发送。
*******************************************************************************************************************/
void Put_byte(unsigned char abyte);

/******************************************************************************************************************
* 函数名称：Get_nibble()
* 功    能：在发送字节函数Put_byte结束后，获取一个十六进制字节
* 入口参数：无
* 出口参数：rxdata          返回接收到的字节
* 说    明：该函数调用两次Nibble2Ascii，将一个字节拆分成高低四位，先转换再次序发送。
*******************************************************************************************************************/
unsigned char Get_nibble(void);

/******************************************************************************************************************
* 函数名称：Get_line()
* 功    能：在获取回显字节函数Get_nibble结束后，获取一字符串字符
* 入口参数：*pline          输入字符串
* 出口参数：err_flg         返回标志
* 说    明：该函数仅允许数字0到9,字母A到F,或者小写字母a到f,及回车<CR>,换行<LF>,和退格<backspace>符号
*           其他符号均为非法字符，将被忽略。
*           正常操作返回0，若超过范围返回1。
*******************************************************************************************************************/
unsigned char Get_line (unsigned char *pline);

/******************************************************************************************************************
* 函数名称：HostCommands()
* 功    能：接收上位机的主机命令，并做出相应操作
* 入口参数：无
* 出口参数：无
* 说    明：该函数为死循环函数
*******************************************************************************************************************/
void HostCommands(void);

/******************************************************************************************************************
* 函数名称：RXhandler()
* 功    能：串口接收中断服务程序
* 入口参数：无
* 出口参数：无
* 说    明：串口USCI_A0接收向量中断
*******************************************************************************************************************/
#pragma vector=USCIAB0RX_VECTOR
__interrupt void RXhandler(void);


#endif

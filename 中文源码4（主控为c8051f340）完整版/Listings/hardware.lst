C51 COMPILER V9.57.0.0   HARDWARE                                                          03/16/2019 22:39:18 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE HARDWARE
OBJECT MODULE PLACED IN .\Objects\hardware.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE hardware.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\hardware.lst) TABS(2) OBJECT(.\Objects\hardware.obj)

line level    source

   1          /********************************************************************************************************
   2          * ÎÄ ¼þ Ãû£ºCOMMUNICATE.H
   3          * ¹¦    ÄÜ£ºRFIDÔÄ¶ÁÆ÷TRF7960ÓëC8051F340Î¢¿ØÖÆÆ÷Ö®¼äÍ¨ÐÅ·½Ê½Í·ÎÄ¼þ¡£
   4          * Ó²¼þÁ¬½Ó£ºC8051F340ÓëTRF7960Ö®¼äÍ¨ÐÅÓ²¼þÁ¬½Ó¹ØÏµÈçÏÂËùÊ¾£º
   5          *                C8051F340                 TRF7960
   6          *********************    PARALLEL INTERFACE    ******************************************         
   7          *               P0.7           IRQ
   8          *         P0.3                 Slave_select
   9          *               P0.2                 SIMO
  10          *               P0.1                 SOMI
  11          *               P0.0                 DATA_CLK
  12          *       P4.0             MOD
  13          *       P4.2         ASK/OOK
  14          *       P4.3         EN
  15          *
  16          * °æ    ±¾£ºV1.0
  17          * ×÷    Õß£ºEMDOOR
  18          * ÈÕ    ÆÚ£º2011-9-29
  19          *********************************************************************************************************/
  20          #include "hardware.h"
  21          #include "communicate.h"
  22          #include <c8051f340.h>
  23          
  24          
  25          void IRQInit(void)
  26          {
  27   1      TCON |= 0X01;//±ßÑØ´¥·¢·½Ê½
  28   1      IT01CF |=0X0F;  //½«ÖÐ¶Ï0ÅäÖÃµ½P0.7,¸ßµçÆ½ÓÐÐ§
  29   1      
  30   1      }
  31          /*********************************************************************************************************
             -*********
  32          * º¯ÊýÃû³Æ£ºdelay_ms()
  33          * ¹¦    ÄÜ£ºÑÓÊ±º¯Êý¡£
  34          * Èë¿Ú²ÎÊý£ºn_ms        ºÁÃëÖµ
  35          * ³ö¿Ú²ÎÊý£ºÎÞ
  36          * Ëµ    Ã÷£º¸Ãº¯ÊýÎªÑÓÊ±º¯Êý£¬Èë¿Ú²ÎÊýÖµÔ½´ó£¬CPUÑÓÊ±µÈ´ýµÄÊ±¼ä¾ÍÔ½³¤¡£
  37          *           ±¾ÑÝÊ¾³ÌÐò£¬½«ÆäÓ¦ÓÃÓÚ·Ç¾«È·µÄÑÓÊ±µÈ´ý³¡ºÏ¡£
  38          *           ×¢Òâ£ºÈë¿Ú²ÎÊýµÄ×î´óÖµÎª 65536¡£           
  39          **********************************************************************************************************
             -*********/
  40          void delay_ms(unsigned int n_ms)
  41          {
  42   1          unsigned int ii1, ii0;
  43   1          
  44   1          for(ii0=n_ms; ii0>0; ii0--) 
  45   1          {
  46   2              ii1 = 10000;                               //µ¥Ñ­»·ÑÓÊ±²ÎÊý¡£Îª¹À¼ÆÖµ£¬²»ÄÜ¾«È·ÑÓÊ±¡£
  47   2              do (ii1--);
  48   2              while (ii1 != 0);
  49   2          }
  50   1        
  51   1      }
  52          
C51 COMPILER V9.57.0.0   HARDWARE                                                          03/16/2019 22:39:18 PAGE 2   

  53          
  54          /*********************************************************************************************************
             -*********
  55          * º¯ÊýÃû³Æ£ºvoid Timer0_Delay (int ms)
  56          * ¹¦    ÄÜ£º¶¨Ê±Æ÷ÉèÖÃº¯Êý¡£
  57          * Èë¿Ú²ÎÊý£ºÎÞ
  58          * ³ö¿Ú²ÎÊý£ºÎÞ
  59          * Ëµ    Ã÷£º³õÊ¼»¯ÉèÖÃ¶¨Ê±Æ÷¼Ä´æÆ÷¡£ ±¾ÑÝÊ¾³ÌÐò£¬½«ÆäÓ¦ÓÃÓÚ¾«È·µÄÑÓÊ±µÈ´ý³¡ºÏ¡£          
  60          **********************************************************************************************************
             -*********/
  61          void Timer0_Delay (int ms)
  62          
  63          {
  64   1          TF0 = 0; // Í£Ö¹¶¨Ê±Æ÷T0²¢Çå³ýÒç³ö±êÖ¾
  65   1          TMOD &= ~0x0f; // ÅäÖÃ¶¨Ê±Æ÷T0Îª16Î»Ä£Ê½
  66   1          TMOD |= 0x01;
  67   1          CKCON &=~ 0x03; // ¶¨Ê±Æ÷T0¼ÆÊýÏµÍ³Ê±ÖÓ
  68   1          ET0 = 1;
  69   1          TR0 = 0; // Í£¶¨Ê±Æ÷T0
  70   1          TH0 = (65535-1000*ms) >> 8; // ÉèÖÃ¶¨Ê±Æ÷T0 1msÒç³ö
  71   1          TL0 = (65535-1000*ms)/256;
  72   1      
  73   1      }
  74          
  75          /*********************************************************************************************************
             -*********
  76          * º¯ÊýÃû³Æ£ºOSCsel()
  77          * ¹¦    ÄÜ£º¾§ÌåÕñµ´Æ÷Ñ¡Ôñ
  78          * Èë¿Ú²ÎÊý£ºmode        Ñ¡ÔñÄÚ²¿»òÕßÍâ²¿Ä£Ê½
  79          * ³ö¿Ú²ÎÊý£ºÎÞ
  80          **********************************************************************************************************
             -*********/
  81          void OSCsel(void)
  82          {
  83   1         int i = 0;
  84   1         OSCICN    = 0x83;
  85   1         CLKMUL    = 0x80;
  86   1         for (i = 0; i < 20; i++);    // ÑÓÊ±µÈ´ý¾§ÌåÎÈ¶¨
  87   1         CLKMUL    |= 0xC0;
  88   1         while ((CLKMUL & 0x20) == 0);
  89   1         CLKSEL    = 0x00;
  90   1      }
  91          
  92          /*********************************************************************************************************
             -*********
  93          * º¯ÊýÃû³Æ£ºTimer0handler()
  94          * ¹¦    ÄÜ£º¶¨Ê±Æ÷ÖÐ¶Ï·þÎñ³ÌÐò
  95          * Èë¿Ú²ÎÊý£ºÎÞ
  96          * ³ö¿Ú²ÎÊý£ºÎÞ
  97          * Ëµ    Ã÷£º¶¨Ê±Æ÷ÖÐ¶Ï·þÎñ³ÌÐò£¬ÓÃÓÚ¾«È·ÑÓÊ±ÓÃ¡£
  98          **********************************************************************************************************
             -*********/
  99          void Timer0handler(void) interrupt 1
 100          {   
 101   1          unsigned char Register[2];
 102   1          StopCounter();
 103   1          
 104   1          /* ¶ÁÈ¡IRQÖÐ¶Ï×´Ì¬¼Ä´æÆ÷ */
 105   1          /*====================================================================================================
             -*/
 106   1          Register[0] = IRQStatus;                        //IRQÖÐ¶Ï×´Ì¬¼Ä´æÆ÷µØÖ·
 107   1          Register[1] = IRQMask;                          //ÐéÄâ¶Á(Dummy read)    
C51 COMPILER V9.57.0.0   HARDWARE                                                          03/16/2019 22:39:18 PAGE 3   

 108   1          ReadCont(Register, 2);
 109   1          /*====================================================================================================
             -*/
 110   1        
 111   1          *Register = *Register & 0xF7;                   //ÉèÖÃÆæÅ¼Ð£ÑéÎ»B3Îª0£¬¹ýÂËÆäÓàÎ»
 112   1          if(*Register == 0x00 || *Register == 0x80)      //ÅÐ¶ÏÊÇ·ñÊ±¼äµ½
 113   1              i_reg = 0x00;
 114   1          else                                            
 115   1              i_reg = 0x01;   
 116   1          
 117   1          // PCON &= ~0X02;                                  //½øÈëµÍ¹¦ºÄÄ£Ê½£¬µ±ÖÐ¶ÏÏìÓ¦Ê±±»»½ÐÑ£¬´Ó¶øÍË³ö¸ÃÄ£Ê
             -½
 118   1          PCON &= ~0X03;                                   //ÍË³öidleºÍstopµÄ×´Ì¬
 119   1      }
 120          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    295    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
